# Docker について

## Docker とは何？

コンテナ型仮想化を実現するプロダクトである

### 仮想化

PC やサーバといったマシンにインストールされている OS の上に別のマシンを仮想的に立ち上げること
パソコンの内部に仮想のパソコンを起動する

### コンテナ型仮想化

- ゲスト OS を起動せずにホスト OS 上の Docker Engine からコンテナを作成し、その中でアプリケーションを動作させる
- ゲスト OS の起動や OS の起動に必要なものが不要となるため軽量に動作することがポイント

### Docker イメージ

コンテナ(アプリケーションの実行環境)を起動するのに必要な設定ファイルをまとめたもの
`imageはコンテナの元であり、imageからコンテナを起動する`
Docker ではこの Image を共有することで様々なマシンで同じコンテナを動作させることができる

### Tag

Docker の Tag は`imageのversion`のことを指す

### image の構造

- layer 構造になっている
- 一度作成された image は編集不可能(読み取り専用)

### image を作るには

- 他人が作った image を Docker Hub から取得する
  docker pull イメージ名
- 自分で作る(他人の image を改良する)
  Dockerfile からイメージを作成する

```
FROM
RUN
CMD
```

Dockerfile を書いて、docker build -t ~~~を実行する

### docker build -t イメージ名 .
imageを作成する際にイメージ名の後にdocker daemonへ転送するファイルの範囲を指定する必要があり、それをビルドコンテキストという
この場合は . なのでカレンとディレクトリをさす
docker buildはデフォルトではビルドコンテキスト上のDockerfileを読み込むようになっているのでそこに配置する必要がある

### imageからコンテナの起動
- docker pull
DockerHubからイメージの取得
- docker create
取得したイメージからコンテナを作成
- docker start 
コンテナを起動する

上の3つをまとめて docker runでできる

## Dockerにおけるデータ管理
起動したコンテナ内で扱う動的なデータは読み書き可能な最上レイヤー(コンテナレイヤー)にもおけるが
以下のようなデメリットがある。
- コンテナが削除された時点でコンテナのデータは消える
- コンテナ間でデータの共有ができない
- コンテナレイヤーへのデータの書き込みは通常ファイルシステムと異なるユニオンファイルシステムが使用されているため書き込み速度が遅い

そのためDockerではホストマシン上にデータを管理し、それをコンテナへマウントしている。
ホストマシン上に自動生成される指定ディレクトリをコンテナにマウントする手法

### volume
ホストマシン上に自動生成される指定ディレクトリ(/var/lib/docker/volumes)をコンテナへマウントする手法

ホストマシン上で
docker volume create volumeの名前 
でvolume(var/lib/docker/volumes)ディレクトリを作成し、コンテナを起動する際に
--mountオプションをつけてvolumeをマウントする。
このホスト上のディレクトリを異なるコンテナ間で共有することも可能で編集権限を持たせることも可能。

さらには
`docker volume ls`でvolumeの一覧を確認することもできる
コンテナを削除してもvolumeは残るので削除する必要があり

- bind mount 
ホストマシン上の任意のディレクトリをマウントできる


# Dockerネットワーク
複数立ち上げたコンテナ間で通信をする手法