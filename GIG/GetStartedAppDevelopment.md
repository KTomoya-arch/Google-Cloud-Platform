# Developing Applications with Google Cloud

## 疎結合のマイクロサービスと API ゲートウェイ

多くの人に使ってもらえるようなアプリケーションには
安全性、拡張性、回復性、高可用性を備えたアプリの設計・開発の技術が必要

この講義で学ぶ内容は以下

- コード及び環境管理
- 設計開発
- スケーラビリティ
- 信頼性
- 移行
  のベストプラクティス

### コード及び環境管理

- Git などのリポジトリで管理をすることで変更を追跡でき、また継続的な統合とデリバリーの可能なシステムを構築できる
- 構成設定などはファイルに直接書かず、環境変数として定義する
- モノリシックではなくマイクロサービスをお勧めする、その理由はモノリシックでは時間と共にソースが肥大化するため
  - 肥大化するとコード内で変更が必要な箇所を特定しづらくなったりする
  - 例えば、注文・支払い・配送のように複数の機能を持つアプリケーションの一部を変更した場合だとしてもアプリケーション全体をデプロイ、
    テストしなければならず、変更やバグ修正を行う際の労力やリスクが大きすぎるといえる
  - マイクロサービスにすると、注文・支払い・配送それぞれがマイクロサービス個別に更新・デプロイが可能となるし、各サービスは個別で拡張が可能である
- アプリケーションのコンポーネントは実行時に疎結合されるように設計する
- アプリケーションを密結合すると障害、トラフィックの急増、サービス変更でのアプリの回復性が低くなる

### CDN(この講義の内容とは別)

Content Delivery Network(コンテンツデリバリーネットワーク)
WEB コンテンツを効率的かつスピーディに配信できるように工夫されたネットワーク

- なんで CDN は要るのか？
  インターネット上を流れる WEB コンテンツが大容量化している昨今、ネットワークの負荷は高くなり続けており、アクセス集中によって Web 閲覧やコンテンツのダウンロードに時間がかかりすぎることも多々ある。こういった問題を解決するために作られた仕組みが CDN である。

## Google Cloud SDK, Cloud クライアントライブラリ, Firebase SDK

gRPC リモートプロシージャコール

Google SDK には gcloud,bq,gsutil の 3 つのコマンドラインツールがあり、各種 Linux,Windows,Mac へインストールが可能である

- gcloud
  GCP での一般的なタスク実行に使用する、GCP リソースの作成などが可能
- gsutil
  ストレージ関連の管理・操作に使用可能
- bq
  Google の BigQuery のクエリ実行やエンティティ・テーブルの管理に使用できる

## Storage

### Cloud Storage

オブジェクト用のストレージでありオブジェクトには HTTP リクエストによってアクセスできる
静的なコンテンツ、動的なコンテンツも可能　
非構造化データに向いている

### Cloud Datastore

No SQL ドキュメントデータベース
Bigtable の多機能バージョン
スケーラブル(ゼロから 100 万のリクエストまで)

### Bigtable

### Cloud SQL

RDB
レプリケーション
リードレプリカはマスターのインスタンスのコピー

### Cloud Spanner と Cloud SQL の違い

Spanner は実際の主キーを使い、外部キーの代わりにインターリーブされた子レコードを使う点で異なる

- シャーディング、インデックス、レプリケーション
  ⇨ あんまり理解できてないので、また調べること
- レプリケーション
  データベースを複数のサーバーに分散しておき一台のサーバーがトラブった時に残りのサーバーで運用を続ける方法。
- シャーディング
  シャーディングとは、データベースの負荷分散の手法の一つで、一つの表（テーブル）を複数の物理コンピュータに分割して記録する方式。

## Datastore,Google Cloud Storage,Bigtable,CloudSQL

- Datastore
  - NoSQL ドキュメントデータベース
  - Firestore は Datastore の新しいバージョンである
  - NoSQL とは、Not only SQL の略である DB の種類を指す。
    NoSQL は膨大なデータ量に対しても高速な処理を実現する。
    NoSQL は処理速度が速く、大容量なデータでもパフォーマンスを気にせず、効率的に作業ができる。

## RDB と NoSQL の違いは？

- スケールアウト
  サーバー台数を増やすことでシステム全体の処理能力を上げること
- スケールイン
  スケールアウトの逆でサーバー台数を減らす

### NoSQL データベースの型

- Key/Value 型
  キーとバリューという２つの要素を組み合わせたデータモデル。
  スケールアウトしやすい。
- カラム志向型
  カラム指向型はキー・バリューにカラムの概念を追加したデータモデルとなっている。
  一つの Key に対して複数カラムがある。

### RDB と NoSQL データベースの違い

- 一貫性
  RDB には ACID が採用されているため、データの一貫性が担保されるが NoSQL はサーバー水平分散を実現するため
  ACID は搭載されておらず、データの一貫性は低い。
  - ACID とは
    トランザクション管理に求められる４つの特性 Atomicity,Consistency,Isolation,Durability
    - Atomicity
    - Consistency
    - Isolation
    - Durability
- 検索性
  RDB は SQL を使用することで複雑な検索でも正確に処理ができるが NoSQL は SQL を使用しないため、高度な検索はできない。
- 分散性
  RDB はサーバー分散の機能がないが NoSQL はサーバーの水平分散が可能。
- 処理速度
  RDB は大量のデータを処理する場合には処理速度が低下するが NoSQL はデータ量に関わらず処理速度が落ちない。

- Cloud Storage
  - オブジェクトストレージ,HTTP リクエストでアクセス可能
  - ストリーミング動画、画像、ウェブのアセット・ライブラリなどの保存に適している

## Cloud Datastore のまとめ

- NoSQL データベース
- Entity を使用する、祖先パス関係を指定するとエンティティグループを作成できる
- 個々のプロパティにインデックスがある
- 複合インデックスを使用する
- シームレスにスケールアウトする

## GCS

- どういう用途に適しているか？
  大量のデータを保存/取得する場合や数 TB のファイルエクスポートやデータのダンプを保存する場合に最適である
  - ダンプ
    メモリやストレージのような記憶装置に記録された内容をまとめて、表示、印刷、記録することやそれによって写された内容のこと

バケットの作成及びオブジェクトの取得/保存,Regional/Multi-Regional,CORS 設定

- 指数バックオフ

- IAM か ACL(Access Control List)でアクセス制御を行う
- 適切なクラスを選択しよう

